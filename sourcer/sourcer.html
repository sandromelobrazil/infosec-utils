<html>
    <head>
        <link rel="stylesheet" type="text/css" href="tools.css">
        <link rel="stylesheet" type="text/css" href="https://raw.githubusercontent.com/mantvydasb/nodspot-web/master/css/normalize.css">
        <meta http-equiv="content-type" content="text/php; charset=utf-8" />
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <title>Source Code Viewer</title>
    </head>

    <body>
		<h1>Source Code Viewer</h1>
		
		<div class="col col3">
				<input id="url" placeholder="Enter URL and hit enter" onkeyup="getSourceCodeByUrl(event)" text/>
				<textarea id="sourceCodeTextArea" onclick="">Source code will be shown here..</textarea>	
		</div>		
		<div class="col col2">
			<h2>External URLs</h2>

				<textarea id="extractedUrlsTextArea" onclick="">Extracted URLs will be shown here..</textarea>	
		</div>		

	</body>
	
</html>


<script>
var sourceCodeTextArea = $('#sourceCodeTextArea'),
	extractUrlsTextArea = $('#extractedUrlsTextArea'),
	urlInput = $('#url');
	urlInput.focus();

getSourceCodeByUrl = function(event) {
	if (event.keyCode == 13) {
		var url = "index.php?url=" + $(event.target).val(),
			response = $.get(url, function(data) {
			sourceCodeTextArea.val(data);
			souceCodeText = sourceCodeTextArea.val();
			extractedUrls = extractUrls(souceCodeText);
			extractdedDomain = extractDomain(urlInput.val());
			sanitisedUrls = sanitiseExtractedUrls(extractdedDomain, extractedUrls);
			extractUrlsTextArea.val(sanitisedUrls);
		});
	}
}

sanitiseExtractedUrls = function(domain, extractedUrls) {
	sanitisedUrls = [];
	extractedUrls = extractedUrls.split("\n");

	$.each(extractedUrls, function(index, url) {
		if (url.indexOf(domain) < 0) {
			sanitisedUrls.push(url);
		}
	});

	return convertArrayToStringWithNewLines(sanitisedUrls);	
}

convertArrayToStringWithNewLines = function(urls) {
	return urls.toString().replace(/\,/g,"\n");
}

extractDomain = function(string) {
	regex = /^(?:https?:)?(?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n]+)/gi,
	domain = string.match(regex)[0].replace(/(https?:\/\/)?(www.)?/,"");
	
	return domain;
}

extractUrls = function(string) {
	var regex = /(https?:\/\/)([.[a-zA-Z/?#=0-9_:&;-]+)/gi,
		extractedUrls = souceCodeText.match(regex);
	
	return convertArrayToStringWithNewLines(extractedUrls);
}

</script>